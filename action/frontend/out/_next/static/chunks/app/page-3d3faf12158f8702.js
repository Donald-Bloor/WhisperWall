(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{415:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>u});var i=a(5155),n=a(2115),s=a(8678),r=a(5242);let l=[{anonymous:!1,inputs:[{indexed:!0,internalType:"uint256",name:"id",type:"uint256"},{indexed:!0,internalType:"address",name:"author",type:"address"},{indexed:!1,internalType:"string",name:"aliasName",type:"string"},{indexed:!1,internalType:"string",name:"message",type:"string"},{indexed:!1,internalType:"uint64",name:"createdAt",type:"uint64"}],name:"WishCreated",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"uint256",name:"id",type:"uint256"},{indexed:!0,internalType:"address",name:"user",type:"address"}],name:"WishCheered",type:"event"},{inputs:[{internalType:"string",name:"message",type:"string"},{internalType:"string",name:"aliasName",type:"string"}],name:"createWish",outputs:[{internalType:"uint256",name:"id",type:"uint256"}],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"uint256",name:"id",type:"uint256"}],name:"getCheersHandle",outputs:[{internalType:"euint32",name:"",type:"bytes32"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"id",type:"uint256"}],name:"getCheersMirror",outputs:[{internalType:"uint32",name:"",type:"uint32"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"id",type:"uint256"}],name:"getWish",outputs:[{internalType:"uint256",name:"wishId",type:"uint256"},{internalType:"address",name:"author",type:"address"},{internalType:"string",name:"message",type:"string"},{internalType:"string",name:"aliasName",type:"string"},{internalType:"uint64",name:"createdAt",type:"uint64"}],stateMutability:"view",type:"function"},{inputs:[],name:"getWishes",outputs:[{components:[{internalType:"uint256",name:"id",type:"uint256"},{internalType:"address",name:"author",type:"address"},{internalType:"string",name:"message",type:"string"},{internalType:"string",name:"aliasName",type:"string"},{internalType:"uint64",name:"createdAt",type:"uint64"},{internalType:"euint32",name:"cheers",type:"bytes32"},{internalType:"uint32",name:"cheersMirror",type:"uint32"}],internalType:"struct WishBoard.WishItem[]",name:"items",type:"tuple[]"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"id",type:"uint256"},{internalType:"externalEuint32",name:"plusOneExt",type:"bytes32"},{internalType:"bytes",name:"inputProof",type:"bytes"}],name:"cheerWish",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"nextWishId",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"protocolId",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"pure",type:"function"}],d={0xaa36a7:{address:"0x407798123cfAD361c47BaBd196C8551aE2D0CEfd"}};var c=a(7733),o=a(2821);function u(){let[e,t]=(0,n.useState)(void 0),[u,m]=(0,n.useState)(void 0),[p,h]=(0,n.useState)(void 0),[y,x]=(0,n.useState)(void 0),[g,w]=(0,n.useState)("idle"),[b,f]=(0,n.useState)(""),[v,N]=(0,n.useState)(void 0),[j,S]=(0,n.useState)([]),[T,k]=(0,n.useState)(""),[C,M]=(0,n.useState)(""),[E,W]=(0,n.useState)(!1),[D,A]=(0,n.useState)(new Set),I=(0,n.useMemo)(()=>{let e=d["11155111"]||d[String(y||"")];return null==e?void 0:e.address},[y]),P=(0,n.useMemo)(()=>{if(I&&u)return new s.NZ(I,l,u)},[I,u]);(0,n.useEffect)(()=>{(async()=>{var e,a,i,n;if(!window.ethereum)return;let s=new r.k(window.ethereum);t(s),x(Number((await s.getNetwork()).chainId));let l=await s.getSigner().catch(()=>void 0);l&&(m(l),h(await l.getAddress())),null==(a=window.ethereum)||null==(e=a.on)||e.call(a,"chainChanged",()=>window.location.reload()),null==(n=window.ethereum)||null==(i=n.on)||i.call(n,"accountsChanged",()=>window.location.reload())})()},[]),(0,n.useEffect)(()=>{(async()=>{try{let e;w("loading-sdk");try{let t=await a.e(494).then(a.bind(a,3494));e=t&&(t.initSDK||t.createInstance)?t:null==t?void 0:t.default}catch(t){e=void 0}if(e&&e.initSDK&&e.createInstance||(window.relayerSDK||await new Promise((e,t)=>{let a=document.createElement("script");a.src="https://cdn.zama.ai/relayer-sdk-js/0.2.0/relayer-sdk-js.umd.cjs",a.type="text/javascript",a.async=!0,a.onload=()=>e(),a.onerror=()=>t(Error("Failed to load Relayer SDK UMD")),document.head.appendChild(a)}),e=window.relayerSDK),!e||!e.initSDK||!e.createInstance||!e.SepoliaConfig)throw Error("Relayer SDK not available after fallback");await e.initSDK();let t=await e.createInstance({...e.SepoliaConfig,network:window.ethereum});N(t),w("ready")}catch(e){w("error"),f(String((null==e?void 0:e.message)||e))}})()},[]);let K=async()=>{if(!window.ethereum)return;await window.ethereum.request({method:"eth_requestAccounts"});let e=new r.k(window.ethereum),t=await e.getSigner();m(t),h(await t.getAddress()),x(Number((await e.getNetwork()).chainId))},q=async()=>{if(I&&e)try{let t=new s.NZ(I,l,e),a=(await t.getWishes()).map(e=>({id:e.id,author:e.author,message:e.message,aliasName:e.aliasName,createdAt:e.createdAt,cheersMirror:e.cheersMirror?Number(e.cheersMirror):0})).sort((e,t)=>Number(t.createdAt-e.createdAt));S(a)}catch(e){f("Failed to load wishes: ".concat((null==e?void 0:e.message)||e))}};(0,n.useEffect)(()=>{q()},[I]);let _=async()=>{if(!P||!T)return void f("Please write your wish first");W(!0),f("Submitting your wish...");try{let e=await P.createWish(T,C||"");await e.wait(),k(""),M(""),f("Your wish has been cast to the chain ✨"),setTimeout(()=>q(),1200)}catch(e){f("Submit failed: ".concat((null==e?void 0:e.message)||e))}finally{W(!1)}},B=async e=>{if(!P||!v||!p)return void f("Please connect wallet and wait for FHEVM ready");let t=String(e);A(e=>new Set([...e,t])),f("Encrypting your cheer...");try{let t=v.createEncryptedInput(P.target,p);t.add32(BigInt(1));let a=await t.encrypt(),i=await P.cheerWish(e,a.handles[0],a.inputProof);await i.wait(),f("Thanks for your cheer!"),setTimeout(()=>q(),900)}catch(e){f("Cheer failed: ".concat((null==e?void 0:e.message)||e))}finally{A(e=>{let a=new Set(e);return a.delete(t),a})}},F=async t=>{if(v&&e&&I)try{var a,i;let n,r=new s.NZ(I,l,e),d=await r.getCheersHandle(t);if("function"==typeof v.decrypt)try{n=await v.decrypt(I,d)}catch(e){"function"==typeof v.decryptPublic&&(n=await v.decryptPublic(I,d))}else"function"==typeof v.decryptPublic&&(n=await v.decryptPublic(I,d));f("Decrypted cheers for #".concat(String(t),": ").concat(null!=(i=null==n||null==(a=n.toString)?void 0:a.call(n))?i:String(n)))}catch(e){f("Decrypt failed: ".concat((null==e?void 0:e.message)||e))}},H=(0,i.jsxs)("div",{className:(0,o.$)("inline-flex items-center gap-2 px-4 py-2 rounded-full text-sm font-medium","idle"===g&&"text-gray-400 bg-white/10","loading-sdk"===g&&"text-sky-300 bg-sky-500/10","ready"===g&&"text-emerald-300 bg-emerald-500/10","error"===g&&"text-red-300 bg-red-500/10"),children:[(0,i.jsx)("span",{className:(0,o.$)("w-2 h-2 rounded-full","loading-sdk"===g?"bg-sky-300 animate-pulse":"ready"===g?"bg-emerald-300":"error"===g?"bg-red-300":"bg-gray-400")}),"idle"===g?"Booting...":"loading-sdk"===g?"Loading FHEVM SDK...":"ready"===g?"Ready":"Error"]});return(0,i.jsx)("div",{className:"min-h-screen bg-ink",children:(0,i.jsxs)("main",{className:"container mx-auto px-4 py-10 max-w-6xl",children:[(0,i.jsxs)("div",{className:"relative mb-10",children:[(0,i.jsx)("div",{className:"absolute inset-0 bg-[length:200%_200%] bg-gradient-to-r from-aqua via-lilac to-mint opacity-20 blur-3xl animate-shimmer"}),(0,i.jsxs)("div",{className:"relative flex items-center justify-between",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("h1",{className:"text-4xl md:text-6xl font-extrabold tracking-tight",children:"Wishing Well"}),(0,i.jsx)("p",{className:"text-white/70 mt-3",children:"Make a wish, cheer others, privacy-preserved with FHE."})]}),(0,i.jsxs)("div",{className:"flex items-center gap-4",children:[H,p?(0,i.jsxs)("div",{className:"glass px-4 py-2 rounded-full text-sm text-white/80",children:[p.slice(0,6),"...",p.slice(-4)," | Chain: ",y]}):(0,i.jsx)("button",{onClick:K,className:"px-5 py-2 rounded-full bg-aqua text-ink font-semibold hover:brightness-110 transition",children:"Connect Wallet"})]})]})]}),(0,i.jsxs)("section",{className:"grid md:grid-cols-2 gap-8 mb-12",children:[(0,i.jsxs)(c.P.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"glass rounded-3xl p-8",children:[(0,i.jsx)("h2",{className:"text-2xl font-bold mb-6",children:"Cast Your Wish ✨"}),(0,i.jsxs)("div",{className:"space-y-5",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{className:"block text-sm text-white/70 mb-2",children:"Your wish"}),(0,i.jsx)("textarea",{className:"w-full rounded-2xl bg-white/5 border border-white/10 px-4 py-3 outline-none focus:ring-2 focus:ring-aqua min-h-[120px]",maxLength:200,value:T,onChange:e=>k(e.target.value),placeholder:"I wish for..."}),(0,i.jsxs)("div",{className:"text-xs text-white/40 mt-1",children:[T.length,"/200"]})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{className:"block text-sm text-white/70 mb-2",children:"Alias (optional)"}),(0,i.jsx)("input",{className:"w-full rounded-2xl bg-white/5 border border-white/10 px-4 py-3 outline-none focus:ring-2 focus:ring-aqua",maxLength:64,value:C,onChange:e=>M(e.target.value),placeholder:"e.g. Stargazer"})]}),(0,i.jsxs)("div",{className:"flex gap-3",children:[(0,i.jsx)("button",{onClick:_,disabled:!T||E,className:"px-6 py-3 rounded-2xl bg-gradient-to-r from-aqua to-mint text-ink font-semibold disabled:opacity-50",children:E?"Submitting...":"Submit to Chain"}),(0,i.jsx)("button",{onClick:q,className:"px-6 py-3 rounded-2xl bg-white/10 hover:bg-white/15",children:"Refresh"})]})]})]}),(0,i.jsxs)(c.P.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"glass rounded-3xl p-8",children:[(0,i.jsx)("h2",{className:"text-2xl font-bold mb-6",children:"Activity"}),(0,i.jsxs)("div",{className:"text-white/70 text-sm",children:["Contract: ",I||"Not configured yet"]}),b&&(0,i.jsx)("div",{className:"mt-4 p-3 rounded-xl bg-white/10 text-sm",children:b})]})]}),(0,i.jsxs)("section",{children:[(0,i.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,i.jsx)("h2",{className:"text-2xl font-bold",children:"Latest Wishes"}),(0,i.jsx)("button",{onClick:q,className:"px-4 py-2 rounded-xl bg-white/10 hover:bg-white/15",children:"Reload"})]}),(0,i.jsx)("div",{className:"grid gap-6 md:grid-cols-2 lg:grid-cols-3",children:j.map(e=>(0,i.jsxs)("div",{className:"glass rounded-3xl p-6",children:[(0,i.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{className:"font-semibold",children:e.aliasName||"".concat(e.author.slice(0,6),"...").concat(e.author.slice(-4))}),(0,i.jsx)("div",{className:"text-xs text-white/50",children:new Date(1e3*Number(e.createdAt)).toLocaleString()})]}),(0,i.jsxs)("div",{className:"text-sm text-white/60",children:["#",String(e.id)]})]}),(0,i.jsx)("p",{className:"text-white/90 whitespace-pre-wrap break-words mb-4",children:e.message}),(0,i.jsxs)("div",{className:"flex items-center gap-2",children:[(0,i.jsxs)("button",{onClick:()=>B(e.id),disabled:D.has(String(e.id)),className:"px-3 py-2 rounded-xl bg-aqua text-ink text-sm font-semibold disabled:opacity-50",children:[D.has(String(e.id))?"Cheering...":"Cheer"," ",e.cheersMirror?"(".concat(e.cheersMirror,")"):""]}),(0,i.jsx)("button",{onClick:()=>F(e.id),className:"px-3 py-2 rounded-xl bg-white/10 text-sm",children:"Decrypt FHE"})]})]},String(e.id)))}),0===j.length&&(0,i.jsx)("div",{className:"text-center py-16 text-white/60",children:"No wishes yet. Be the first to cast one."})]})]})})}},9524:(e,t,a)=>{Promise.resolve().then(a.bind(a,415))}},e=>{e.O(0,[16,441,255,358],()=>e(e.s=9524)),_N_E=e.O()}]);